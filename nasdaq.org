
- request for realtime trades:

#+begin_example
curl 'https://api.nasdaq.com/api/quote/LITE/realtime-trades?&limit=20&fromTime=00:00' \
  -H 'authority: api.nasdaq.com' \
  -H 'accept: application/json, text/plain, */*' \
  -H 'user-agent: Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Mobile Safari/537.36' \
  -H 'origin: https://www.nasdaq.com' \
  -H 'sec-fetch-site: same-site' \
  -H 'sec-fetch-mode: cors' \
  -H 'sec-fetch-dest: empty' \
  -H 'referer: https://www.nasdaq.com/market-activity/stocks/lite/latest-real-time-trades' \
  -H 'accept-language: en-US,en;q=0.9' \
  --compressed
#+end_example

- python requests, converted with https://curl.trillworks.com/

#+begin_example
import requests

headers = {
    'authority': 'api.nasdaq.com',
    'accept': 'application/json, text/plain, */*',
    'user-agent': 'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Mobile Safari/537.36',
    'origin': 'https://www.nasdaq.com',
    'sec-fetch-site': 'same-site',
    'sec-fetch-mode': 'cors',
    'sec-fetch-dest': 'empty',
    'referer': 'https://www.nasdaq.com/market-activity/stocks/lite/latest-real-time-trades',
    'accept-language': 'en-US,en;q=0.9',
}

params = (
    ('', ''),
    ('limit', '20'),
    ('fromTime', '00:00'),
)

response = requests.get('https://api.nasdaq.com/api/quote/LITE/realtime-trades, headers=headers, params=params)

#NB. Original query string below. It seems impossible to parse and
#reproduce query strings 100% accurately so the one below is given
#in case the reproduced version is not "correct".
# response = requests.get('https://api.nasdaq.com/api/quote/LITE/realtime-trades?&limit=20&fromTime=00:00', headers=headers)

#+end_example

- request as fetch
#+begin_example
fetch("https://api.nasdaq.com/api/quote/LITE/realtime-trades?&limit=20&fromTime=00:00", {
  "headers": {
    "accept": "application/json, text/plain, */*",
    "accept-language": "en-US,en;q=0.9",
    "sec-fetch-dest": "empty",
    "sec-fetch-mode": "cors",
    "sec-fetch-site": "same-site"
  },
  "referrer": "https://www.nasdaq.com/market-activity/stocks/lite/latest-real-time-trades",
  "referrerPolicy": "no-referrer-when-downgrade",
  "body": null,
  "method": "GET",
  "mode": "cors",
  "credentials": "omit"
});
#+end_example

- request as node.js fetch
#+begin_example
fetch("https://api.nasdaq.com/api/quote/LITE/realtime-trades?&limit=20&fromTime=00:00", {
  "headers": {
    "accept": "application/json, text/plain, */*",
    "accept-language": "en-US,en;q=0.9",
    "sec-fetch-dest": "empty",
    "sec-fetch-mode": "cors",
    "sec-fetch-site": "same-site"
  },
  "referrer": "https://www.nasdaq.com/market-activity/stocks/lite/latest-real-time-trades",
  "referrerPolicy": "no-referrer-when-downgrade",
  "body": null,
  "method": "GET",
  "mode": "cors"
});
#+end_example

- response:

#+begin_example
{
   "data":{
      "symbol":"lite",
      "totalRecords":100,
      "offset":0,
      "limit":20,
      "headers":{
         "nlsTime":"NLS Time (ET)",
         "nlsPrice":"NLS Price",
         "nlsShareVolume":"NLS Share Volume"
      },
      "rows":[
         {
            "nlsTime":"09:54:48",
            "nlsPrice":"$ 81.47",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:54:48",
            "nlsPrice":"$ 81.48",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:54:15",
            "nlsPrice":"$ 81.6",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:54:06",
            "nlsPrice":"$ 81.48",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:54:02",
            "nlsPrice":"$ 81.665",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:54:01",
            "nlsPrice":"$ 81.49",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:54:01",
            "nlsPrice":"$ 81.46",
            "nlsShareVolume":"200"
         },
         {
            "nlsTime":"09:54:01",
            "nlsPrice":"$ 81.46",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:54:00",
            "nlsPrice":"$ 81.49",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:53:10",
            "nlsPrice":"$ 81.54",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:53:05",
            "nlsPrice":"$ 81.46",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:53:05",
            "nlsPrice":"$ 81.46",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:52:57",
            "nlsPrice":"$ 81.525",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:52:55",
            "nlsPrice":"$ 81.53",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:52:46",
            "nlsPrice":"$ 81.41",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:52:28",
            "nlsPrice":"$ 81.31",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:52:28",
            "nlsPrice":"$ 81.32",
            "nlsShareVolume":"156"
         },
         {
            "nlsTime":"09:52:28",
            "nlsPrice":"$ 81.32",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:52:11",
            "nlsPrice":"$ 81.26",
            "nlsShareVolume":"100"
         },
         {
            "nlsTime":"09:51:46",
            "nlsPrice":"$ 81.3585",
            "nlsShareVolume":"100"
         }
      ]
   },
   "message":null,
   "status":{
      "rCode":200,
      "bCodeMessage":null,
      "developerMessage":null
   }
}
#+end_example

- how to access data
#+begin_example
d['data']['rows']
#+end_example


- read 100 rows at two different timepoints
- try to merge

#+begin_export 
>>> c[(c.nlsShareVolume_x != c.nlsShareVolume_y)]
     nlsTime   nlsPrice_x nlsShareVolume_x             request_time_x   nlsPrice_y nlsShareVolume_y             request_time_y
20  15:14:22    $ 1503.74              100 2020-07-16 21:15:13.345747  $ 1503.8799              150 2020-07-16 21:16:22.599059
22  15:14:22  $ 1503.8799              150 2020-07-16 21:15:13.345747    $ 1503.74              100 2020-07-16 21:16:22.599059
24  15:14:22  $ 1503.8799              150 2020-07-16 21:15:13.345747    $ 1503.77              100 2020-07-16 21:16:22.599059
26  15:14:22    $ 1503.77              100 2020-07-16 21:15:13.345747  $ 1503.8799              150 2020-07-16 21:16:22.599059
30  15:14:14  $ 1503.3313              100 2020-07-16 21:15:13.345747  $ 1503.2438              736 2020-07-16 21:16:22.599059
31  15:14:14  $ 1503.3313              100 2020-07-16 21:15:13.345747    $ 1504.05              192 2020-07-16 21:16:22.599059
32  15:14:14  $ 1503.2438              736 2020-07-16 21:15:13.345747  $ 1503.3313              100 2020-07-16 21:16:22.599059
34  15:14:14  $ 1503.2438              736 2020-07-16 21:15:13.345747    $ 1504.05              192 2020-07-16 21:16:22.599059
35  15:14:14    $ 1504.05              192 2020-07-16 21:15:13.345747  $ 1503.3313              100 2020-07-16 21:16:22.599059
36  15:14:14    $ 1504.05              192 2020-07-16 21:15:13.345747  $ 1503.2438              736 2020-07-16 21:16:22.599059
64  15:13:47   $ 1504.655              160 2020-07-16 21:15:13.345747    $ 1505.00              165 2020-07-16 21:16:22.599059
65  15:13:47    $ 1505.00              165 2020-07-16 21:15:13.345747   $ 1504.655              160 2020-07-16 21:16:22.599059

#+end_export

- joining this data is quite difficult
- nlsTime isn't a unique key
#+begin_example
>>> a
             nlsPrice nlsShareVolume               request_time
nlsTime                                                        
15:14:30   $ 1503.985            100 2020-07-16 21:15:13.345747
15:14:29    $ 1503.98            100 2020-07-16 21:15:13.345747
15:14:29    $ 1503.97            100 2020-07-16 21:15:13.345747
#+end_example
